---
apiVersion: apps.emqx.io/v2beta1
kind: EMQX
metadata:
  name: emqx
spec:
  image: emqx/emqx:5.4.0

  config:
    mode: "Merge"
    data: |
      authorization {
        sources = [
          {
            type = built_in_database
            enable = true
          }
        ]

        no_match: "deny"
      }
      dashboard {
        listeners.http {
            bind: 18083
        }
        default_username: "admin"
        default_password: "${SECRET_EMQX_ADMIN_PASSWORD}"
      }

  coreTemplate:
    spec:
      replicas: 3
