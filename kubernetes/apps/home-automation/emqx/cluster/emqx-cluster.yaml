---
apiVersion: apps.emqx.io/v2beta1
kind: EMQX
metadata:
  name: emqx
  namespace: home-automation
spec:
  image: emqx/emqx:5.1.5

  config:
    data: |
      authorization {
        sources = [
          {
            type = built_in_database
            enable = true
          }
        ]

        no_match: "deny"
      }
      dashboard {
        listeners.http {
            bind: 18083
        }
        default_username: "admin"
        default_password: "${SECRET_EMQX_ADMIN_PASSWORD}"
      }

  coreTemplate:
    spec:
      replicas: 3

  listenersServiceTemplate:
    metadata:
      annotations:
        io.cilium/lb-ipam-ips: "${LB_EMQX}"
    spec:
      type: LoadBalancer
