---
- name: Onboot - query package version
  register: onboot_version
  ansible.builtin.raw: "{{ unifi_os_cmd }} dpkg-query --showformat='${Version}' --show udm-boot"

- name: Onboot - installation
  when: onboot_version is not defined or (onboot_version.stdout is defined and onboot_version.stdout != udm_onboot_version)
  block:
    - name: Onboot - download package
      ansible.builtin.raw: curl -L "{{ udm_onboot_download_uri }}" -o "{{ unifi_mount_path }}/unifi-os/udm-boot-{{ udm_onboot_version }}.deb"
    - name: Onboot - install package
      ansible.builtin.raw: "{{ unifi_os_cmd }} dpkg -i {{ unifi_os_mount_path }}/udm-boot-{{ udm_onboot_version }}.deb"
