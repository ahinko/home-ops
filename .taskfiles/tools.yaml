---
version: 3

env:
  BREW: |-
    ansible fluxcd/tap/flux kubectl kubectx kubie clusterctl terraform pre-commit shellcheck yamllint sops age libpq coreutils tfsec

tasks:
  install:
    desc: Install/update all required dependencies
    silent: true
    cmds:
      # Install Ansible dependencies
      - "ansible-galaxy install -r infrastructure/requirements.yaml --force"
      - "ansible-galaxy collection install -r infrastructure/requirements.yaml --force"
      # Install dependencies using Brew
      - "arch -arm64 brew install {{.BREW}}"
      # Install Talosctl
      - sudo curl -Lo /usr/local/bin/talosctl https://github.com/siderolabs/talos/releases/download/v1.1.2/talosctl-$(uname -s | tr "[:upper:]" "[:lower:]")-arm64 && sudo chmod +x /usr/local/bin/talosctl
      # Set up pre-commit hooks
      - pre-commit install-hooks

  base64-clipboard:
    desc: Base64 encode whatever is in the clipboard
    silent: true
    cmds:
      - pbpaste | base64 | pbcopy
