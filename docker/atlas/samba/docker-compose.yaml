---

version: '3.8'

services:
  samba:
    container_name: samba
    image: mbentley/timemachine:smb
    restart: always
    environment:
      CUSTOM_SMB_CONF: "true"
      EXTERNAL_CONF: "/etc/timemachine/conf"
    volumes:
      - /tank/backup/tm:/opt
      - /tank/shares:/shares
      - /tank/volumes/samba/user-conf:/etc/timemachine/conf
      - /tank/volumes/samba/conf/smb.conf:/etc/samba/smb.conf:ro
      - /tank/volumes/samba/var/lib/samba:/var/lib/samba
      - /tank/volumes/samba/var/cache/samba:/var/cache/samba
      - /tank/volumes/samba/run/samba:/run/samba
    network_mode: "host"
